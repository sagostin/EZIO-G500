package font

import "unicode"

// BuiltinFont is the default 7-pixel tall font for the EZIO-G500.
// This matches the character set from the reference Perl implementation.
var BuiltinFont = &builtinFont{}

type builtinFont struct{}

func (f *builtinFont) Height() int {
	return 8
}

func (f *builtinFont) GetWidth(r rune) int {
	glyph := f.GetGlyph(r)
	if glyph != nil {
		return len(glyph)
	}
	return 0
}

func (f *builtinFont) GetGlyph(r rune) []byte {
	// Convert lowercase to uppercase for letters
	if r >= 'a' && r <= 'z' {
		r = unicode.ToUpper(r)
	}

	switch r {
	// Letters A-Z
	case 'A':
		return []byte{0x7C, 0x12, 0x12, 0x7C, 0x00}
	case 'B':
		return []byte{0x7E, 0x4A, 0x4A, 0x34, 0x00}
	case 'C':
		return []byte{0x3C, 0x42, 0x42, 0x24, 0x00}
	case 'D':
		return []byte{0x7E, 0x42, 0x42, 0x3C, 0x00}
	case 'E':
		return []byte{0x7E, 0x4A, 0x4A, 0x42, 0x00}
	case 'F':
		return []byte{0x7E, 0x0A, 0x0A, 0x02, 0x00}
	case 'G':
		return []byte{0x3C, 0x42, 0x52, 0x34, 0x00}
	case 'H':
		return []byte{0x7E, 0x08, 0x08, 0x7E, 0x00}
	case 'I':
		return []byte{0x42, 0x7E, 0x42, 0x00}
	case 'J':
		return []byte{0x22, 0x42, 0x3E, 0x02, 0x00}
	case 'K':
		return []byte{0x7E, 0x08, 0x14, 0x62, 0x00}
	case 'L':
		return []byte{0x7E, 0x40, 0x40, 0x40, 0x00}
	case 'M':
		return []byte{0x7E, 0x04, 0x18, 0x04, 0x7E, 0x00}
	case 'N':
		return []byte{0x7E, 0x04, 0x08, 0x10, 0x7E, 0x00}
	case 'O':
		return []byte{0x3C, 0x42, 0x42, 0x3C, 0x00}
	case 'P':
		return []byte{0x7E, 0x12, 0x12, 0x0C, 0x00}
	case 'Q':
		return []byte{0x3C, 0x42, 0x52, 0x3C, 0x40, 0x00}
	case 'R':
		return []byte{0x7E, 0x12, 0x32, 0x4C, 0x00}
	case 'S':
		return []byte{0x44, 0x4A, 0x4A, 0x32, 0x00}
	case 'T':
		return []byte{0x02, 0x02, 0x7E, 0x02, 0x02, 0x00}
	case 'U':
		return []byte{0x3E, 0x40, 0x40, 0x3E, 0x00}
	case 'V':
		return []byte{0x06, 0x18, 0x60, 0x18, 0x06, 0x00}
	case 'W':
		return []byte{0x7E, 0x20, 0x18, 0x20, 0x7E, 0x00}
	case 'X':
		return []byte{0x66, 0x18, 0x18, 0x66, 0x00}
	case 'Y':
		return []byte{0x06, 0x08, 0x70, 0x08, 0x06, 0x00}
	case 'Z':
		return []byte{0x62, 0x52, 0x4A, 0x46, 0x00}

	// Numbers 0-9
	case '0':
		return []byte{0x3C, 0x4A, 0x52, 0x3C, 0x00}
	case '1':
		return []byte{0x44, 0x7E, 0x40, 0x00}
	case '2':
		return []byte{0x64, 0x52, 0x52, 0x4C, 0x00}
	case '3':
		return []byte{0x24, 0x42, 0x4A, 0x34, 0x00}
	case '4':
		return []byte{0x1E, 0x10, 0x7E, 0x10, 0x00}
	case '5':
		return []byte{0x4E, 0x4A, 0x4A, 0x32, 0x00}
	case '6':
		return []byte{0x3C, 0x4A, 0x4A, 0x30, 0x00}
	case '7':
		return []byte{0x02, 0x62, 0x1A, 0x06, 0x00}
	case '8':
		return []byte{0x34, 0x4A, 0x4A, 0x34, 0x00}
	case '9':
		return []byte{0x0C, 0x52, 0x52, 0x3C, 0x00}

	// Punctuation and symbols
	case ' ':
		return []byte{0x00, 0x00, 0x00}
	case '.':
		return []byte{0x40, 0x00}
	case ',':
		return []byte{0x80, 0x40, 0x00}
	case ':':
		return []byte{0x24, 0x00}
	case ';':
		return []byte{0x80, 0x44, 0x00}
	case '!':
		return []byte{0x5E, 0x00}
	case '?':
		return []byte{0x04, 0x52, 0x0C, 0x00}
	case '-':
		return []byte{0x10, 0x10, 0x10, 0x00}
	case '_':
		return []byte{0x80, 0x80, 0x80, 0x00}
	case '+':
		return []byte{0x10, 0x38, 0x10, 0x00}
	case '*':
		return []byte{0x14, 0x08, 0x14, 0x00}
	case '/':
		return []byte{0x60, 0x18, 0x06, 0x00}
	case '\\':
		return []byte{0x06, 0x18, 0x60, 0x00}
	case '(':
		return []byte{0x3C, 0x42, 0x00}
	case ')':
		return []byte{0x42, 0x3C, 0x00}
	case '[':
		return []byte{0x7E, 0x42, 0x00}
	case ']':
		return []byte{0x42, 0x7E, 0x00}
	case '{':
		return []byte{0x08, 0x36, 0x41, 0x00}
	case '}':
		return []byte{0x41, 0x36, 0x08, 0x00}
	case '<':
		return []byte{0x10, 0x28, 0x44, 0x00}
	case '>':
		return []byte{0x44, 0x28, 0x10, 0x00}
	case '=':
		return []byte{0x28, 0x28, 0x28, 0x00}
	case '\'':
		return []byte{0x06, 0x00}
	case '"':
		return []byte{0x06, 0x00, 0x06, 0x00}
	case '`':
		return []byte{0x02, 0x04, 0x00}
	case '@':
		return []byte{0x3C, 0x42, 0x5A, 0x5A, 0x1C, 0x00}
	case '#':
		return []byte{0x28, 0x7C, 0x28, 0x7C, 0x28, 0x00}
	case '$':
		return []byte{0x24, 0x2A, 0x7F, 0x2A, 0x12, 0x00}
	case '%':
		return []byte{0x46, 0x26, 0x10, 0x64, 0x62, 0x00}
	case '^':
		return []byte{0x04, 0x02, 0x04, 0x00}
	case '&':
		return []byte{0x34, 0x4A, 0x54, 0x20, 0x50, 0x00}
	case '|':
		return []byte{0x7E, 0x00}

	// Degree symbol (useful for temperature)
	case 'Â°':
		return []byte{0x06, 0x09, 0x06, 0x00}

	default:
		// Return empty space for unknown characters
		return []byte{0x00, 0x00}
	}
}

// SmallFont is a smaller 5-pixel tall font for compact displays.
var SmallFont = &smallFont{}

type smallFont struct{}

func (f *smallFont) Height() int {
	return 6
}

func (f *smallFont) GetWidth(r rune) int {
	glyph := f.GetGlyph(r)
	if glyph != nil {
		return len(glyph)
	}
	return 0
}

func (f *smallFont) GetGlyph(r rune) []byte {
	if r >= 'a' && r <= 'z' {
		r = unicode.ToUpper(r)
	}

	switch r {
	case 'A':
		return []byte{0x1E, 0x05, 0x1E, 0x00}
	case 'B':
		return []byte{0x1F, 0x15, 0x0A, 0x00}
	case 'C':
		return []byte{0x0E, 0x11, 0x11, 0x00}
	case 'D':
		return []byte{0x1F, 0x11, 0x0E, 0x00}
	case 'E':
		return []byte{0x1F, 0x15, 0x11, 0x00}
	case 'F':
		return []byte{0x1F, 0x05, 0x01, 0x00}
	case 'G':
		return []byte{0x0E, 0x11, 0x19, 0x00}
	case 'H':
		return []byte{0x1F, 0x04, 0x1F, 0x00}
	case 'I':
		return []byte{0x11, 0x1F, 0x11, 0x00}
	case 'J':
		return []byte{0x08, 0x10, 0x0F, 0x00}
	case 'K':
		return []byte{0x1F, 0x04, 0x1B, 0x00}
	case 'L':
		return []byte{0x1F, 0x10, 0x10, 0x00}
	case 'M':
		return []byte{0x1F, 0x02, 0x04, 0x02, 0x1F, 0x00}
	case 'N':
		return []byte{0x1F, 0x02, 0x04, 0x1F, 0x00}
	case 'O':
		return []byte{0x0E, 0x11, 0x0E, 0x00}
	case 'P':
		return []byte{0x1F, 0x05, 0x02, 0x00}
	case 'Q':
		return []byte{0x0E, 0x11, 0x0E, 0x10, 0x00}
	case 'R':
		return []byte{0x1F, 0x05, 0x1A, 0x00}
	case 'S':
		return []byte{0x12, 0x15, 0x09, 0x00}
	case 'T':
		return []byte{0x01, 0x1F, 0x01, 0x00}
	case 'U':
		return []byte{0x0F, 0x10, 0x0F, 0x00}
	case 'V':
		return []byte{0x07, 0x18, 0x07, 0x00}
	case 'W':
		return []byte{0x1F, 0x08, 0x04, 0x08, 0x1F, 0x00}
	case 'X':
		return []byte{0x1B, 0x04, 0x1B, 0x00}
	case 'Y':
		return []byte{0x03, 0x1C, 0x03, 0x00}
	case 'Z':
		return []byte{0x19, 0x15, 0x13, 0x00}

	case '0':
		return []byte{0x0E, 0x11, 0x0E, 0x00}
	case '1':
		return []byte{0x12, 0x1F, 0x10, 0x00}
	case '2':
		return []byte{0x19, 0x15, 0x12, 0x00}
	case '3':
		return []byte{0x11, 0x15, 0x0A, 0x00}
	case '4':
		return []byte{0x07, 0x04, 0x1F, 0x00}
	case '5':
		return []byte{0x17, 0x15, 0x09, 0x00}
	case '6':
		return []byte{0x0E, 0x15, 0x08, 0x00}
	case '7':
		return []byte{0x01, 0x19, 0x07, 0x00}
	case '8':
		return []byte{0x0A, 0x15, 0x0A, 0x00}
	case '9':
		return []byte{0x02, 0x15, 0x0E, 0x00}

	case ' ':
		return []byte{0x00, 0x00}
	case '.':
		return []byte{0x10, 0x00}
	case ':':
		return []byte{0x0A, 0x00}
	case '-':
		return []byte{0x04, 0x04, 0x00}
	case '/':
		return []byte{0x18, 0x04, 0x03, 0x00}
	case '%':
		return []byte{0x13, 0x08, 0x19, 0x00}

	default:
		return []byte{0x00}
	}
}
